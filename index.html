<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Piano Tiles Ultimate â€” MatÃ­as</title>
<style>
/* Variables y colores */
:root {
  --bg-gradient: linear-gradient(120deg,#071127,#0b2140,#1a2a6c);
  --tile-base: #42E695;
  --tile-hit: #FF3CAC;
  --hud-bg: rgba(255,255,255,0.05);
  --hud-text: #cfeff7;
}

/* BODY y fondo animado */
body {
  margin:0;
  font-family: Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  background: linear-gradient(270deg,#071127,#0b2140,#1a2be2,#FF3CAC);
  background-size: 400% 400%;
  animation: gradientShift 30s ease infinite;
  color:#fff;
}
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Contenedor del juego */
#gameContainer {
  position: relative;
  width: 400px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 40px #8A2BE2, 0 0 80px #FF3CAC;
  transition: all 0.3s ease;
}
#gameContainer:hover {
  box-shadow: 0 0 50px #FF3CAC, 0 0 100px #8A2BE2;
}

/* Canvas del tablero */
canvas {
  display: block;
  width: 100%;
  height: 600px;
  border-radius: 12px;
  background: linear-gradient(180deg,#0a0f1a,#07102a);
  border: 6px solid #8A2BE2;
  box-shadow: 0 0 25px #FF3CAC, 0 0 50px #8A2BE2;
  transition: all 0.3s ease;
}

/* Glow al hacer click o hover */
canvas:hover {
  box-shadow: 0 0 30px #42E695, 0 0 60px #FF3CAC, inset 0 0 15px #42E695;
}
canvas:active {
  box-shadow: 0 0 40px #FF3CAC, 0 0 80px #8A2BE2, inset 0 0 20px #FFD700;
  transform: scale(1.02);
}

/* HUD */
.hud {
  display:flex;
  justify-content:space-between;
  margin-top:8px;
  font-size:14px;
}
.hud div {
  background: var(--hud-bg);
  padding: 8px 14px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.2);
  box-shadow: 0 0 10px rgba(255,255,255,0.3);
  text-shadow: 0 0 5px #fff, 0 0 10px #42E695;
  font-weight: bold;
  font-family: 'Orbitron', sans-serif;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: all 0.3s ease;
  animation: pulseHUD 3s infinite alternate;
}
.hud div:hover {
  box-shadow: 0 0 15px #FF3CAC, 0 0 25px #8A2BE2;
  transform: scale(1.05);
}
@keyframes pulseHUD {
  0% { box-shadow: 0 0 10px rgba(255,255,255,0.3); }
  50% { box-shadow: 0 0 20px #42E695, 0 0 30px #FF3CAC; }
  100% { box-shadow: 0 0 10px rgba(255,255,255,0.3); }
}

/* Botones */
#controls {
  margin-top:10px;
  display:flex;
  justify-content:space-between;
}
button {
  padding:10px 16px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:bold;
  background: linear-gradient(45deg,#00e676,#00bfa5);
  color:#02241a;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px #00e676, 0 0 20px #00bfa5;
}
button:hover {
  background: linear-gradient(45deg,#FF3CAC,#8A2BE2);
  box-shadow: 0 0 15px #FF3CAC, 0 0 25px #8A2BE2;
  transform: scale(1.1);
}
button:active {
  transform: scale(0.95);
  box-shadow: 0 0 5px #FF3CAC, 0 0 10px #8A2BE2 inset;
}

/* VibraciÃ³n */
.hud div:active, button:active {
  animation: shake 0.2s;
}
@keyframes shake {
  0% { transform: translate(0,0); }
  25% { transform: translate(2px,-2px); }
  50% { transform: translate(-2px,2px); }
  75% { transform: translate(2px,2px); }
  100% { transform: translate(0,0); }
}

/* Ajustes para mÃ³viles */
@media (max-width: 480px) {
  #gameContainer { width: 90vw; }
  canvas { height: 400px; border-width:4px; border-radius:8px; }
  .hud { font-size:12px; }
  .hud div { padding:6px 10px; border-radius:8px; }
  button { padding:8px 12px; font-size:14px; border-radius:8px; }
}
</style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas" width="400" height="600"></canvas>
  <div class="hud">
    <div>Jugador: <span id="hudName">Invitado</span></div>
    <div>Puntos: <span id="hudScore">0</span></div>
    <div>Nivel: <span id="hudLvl">1</span></div>
  </div>
  <div id="controls">
    <button id="btnStart">â–¶ Jugar</button>
    <button id="btnRestart">ðŸ”„ Reiniciar</button>
  </div>
</div>

<audio id="gameSong" src="song.mp3" preload="auto"></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const hudScore = document.getElementById('hudScore');
const hudLvl = document.getElementById('hudLvl');
const btnStart = document.getElementById('btnStart');
const btnRestart = document.getElementById('btnRestart');
const gameSong = document.getElementById('gameSong');

const BPM = 118;
const intervalo = (60 / BPM) * 1000;

let tiles = [];
let score = 0;
let level = 1;
let speed = 1;
let running = false;
const cols = 4;
const tileW = canvas.width / cols;
const tileH = 150;

let spawnInterval;
let speedInterval;

const keyMap = { '1':0, '2':1, '3':2, '4':3 };
const colors = ['#FF3CAC','#2B86C5','#42E695','#FFAA00','#FF1B6B','#8A2BE2','#00C2FF'];

function spawnTile() {
  const col = Math.floor(Math.random() * cols);
  tiles.push({ x: col * tileW, y: -tileH, w: tileW, h: tileH, hit: false });
}

function getActiveTile() {
  if (tiles.length === 0) return null;
  return tiles.reduce((prev,curr)=> prev.y>curr.y?prev:curr);
}

function drawTiles() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const activeTile = getActiveTile();

  tiles.forEach(t=>{
    let colorIdx = Math.min(Math.floor(speed-1),colors.length-1);
    let fillColor = t.hit ? '#555' : (t===activeTile?'#FFD700':colors[colorIdx]);

    // Relleno y borde
    ctx.fillStyle = fillColor;
    ctx.fillRect(t.x+6,t.y+6,t.w-12,t.h-12);

    ctx.fillStyle = 'rgba(255,255,255,0.1)';
    ctx.fillRect(t.x+6,t.y+6,t.w-12,6);

    ctx.strokeStyle = t.hit?'#AAA':(t===activeTile?'#333':'#fff');
    ctx.lineWidth=3;
    ctx.shadowColor='#8A2BE2';
    ctx.shadowBlur=8;
    ctx.strokeRect(t.x+6,t.y+6,t.w-12,t.h-12);
    ctx.shadowBlur=0;
  });

  // NÃºmeros columnas
  ctx.fillStyle='white';
  ctx.font='30px Arial';
  ctx.textAlign='center';
  ctx.textBaseline='bottom';
  for(let i=0;i<cols;i++){
    const centerX = i*tileW + tileW/2;
    const posY = canvas.height - 10;
    ctx.fillText(i+1, centerX, posY);
  }
}

function update() {
  if(!running) return;
  for(let i=tiles.length-1;i>=0;i--){
    tiles[i].y += 3*speed;
    if(tiles[i].y + tiles[i].h >= canvas.height && !tiles[i].hit){
      gameOver();
      return;
    }
  }
  drawTiles();
  hudScore.textContent = score;
  hudLvl.textContent = level;
  requestAnimationFrame(update);
}

function handleTileHit(tile){
  tile.hit=true;
  tiles.splice(tiles.indexOf(tile),1);
  score+=10;
  level = 1+Math.floor(score/50);
}

canvas.addEventListener('click',e=>{
  if(!running) return;
  const activeTile=getActiveTile();
  if(!activeTile) return;
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;
  if(x<activeTile.x||x>activeTile.x+activeTile.w||y<activeTile.y||y>activeTile.y+activeTile.h){
    gameOver();
    return;
  }
  handleTileHit(activeTile);
});

document.addEventListener('keydown',e=>{
  if(!running) return;
  const col=keyMap[e.key];
  if(col===undefined) return;
  const activeTile=getActiveTile();
  if(!activeTile) return;
  if(activeTile.x/tileW!==col){ gameOver(); return; }
  handleTileHit(activeTile);
});

function gameOver(){
  running=false;
  clearInterval(spawnInterval);
  clearInterval(speedInterval);
  gameSong.pause();
  alert('Game Over! Puntos: '+score);
}

function startGame(){
  clearInterval(spawnInterval);
  clearInterval(speedInterval);
  tiles=[];
  score=0;
  level=1;
  speed=1;
  running=true;
  gameSong.currentTime=0;
  gameSong.play();
  spawnInterval=setInterval(spawnTile,intervalo);
  speedInterval=setInterval(()=>{if(running) speed+=0.015;},5500);
  update();
}

btnStart.addEventListener('click',startGame);
btnRestart.addEventListener('click',()=>{
  running=false;
  clearInterval(spawnInterval);
  clearInterval(speedInterval);
  startGame();
});
</script>

</body>
</html>

